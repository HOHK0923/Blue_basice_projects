index=main source="/var/log/httpd/access_log"
| eval is_upload   = if(method="POST" AND uri="/new_post.php", 1, 0)
| eval is_webshell = if(method="GET"  AND uri="/file.php",      1, 0)
| bin _time span=30s
| stats
    sum(is_upload)   AS upload_hits
    sum(is_webshell) AS webshell_hits
    values(uri)      AS pages
    count            AS req_count
  BY clientip _time
| where upload_hits >= 2 or webshell_hits >= 1
